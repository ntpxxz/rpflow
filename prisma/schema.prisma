// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//--- Enums ---
enum UserRole {
  Admin @map("admin")
  User  @map("user")
}

enum RequestStatus {
  Pending   @map("pending")   // ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏£‡πà‡∏≤‡∏á)
  Approving @map("approving") // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
  Approved  @map("approved")  // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á PO)
  Ordered   @map("ordered")   // ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß
  Received  @map("received")  // ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  Rejected  @map("rejected")  // ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
  Cancelled @map("cancelled") // ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ Canceled
}

enum ApprovalStatus {
  Pending  @map("pending")
  Approved @map("approved")
  Rejected @map("rejected")
}

enum POStatus {
  Pending   @map("pending")  // ‡∏£‡πà‡∏≤‡∏á PO
  Sent      @map("sent")      // ‡∏™‡πà‡∏á PO ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Vendor ‡∏Å‡πá‡∏ï‡∏≤‡∏°)
  Partial   @map("partial")  // ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  Fulfilled @map("fulfilled") // ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  Cancelled @map("cancelled")
}

//--- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å (Master Data) ---

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Catalog)
model ItemMaster {
  id          String   @id
  itemCode    String   @unique @map("item_code") // SKU
  name        String
  description String?
  unitPrice   Decimal  @default(0) @map("unit_price") // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  //requestItems  RequestItem[]
  poItems       PurchaseOrderItem[]

  @@map("item_master")
}

//--- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ (Process Tables) ---

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
enum UserRole {
  REQUESTER @map("requester") 
  APPROVER  @map("approver")  
  PURCHASER @map("purchaser")  
  ADMIN     @map("admin") 
}

model User {
  id              String           @id @default(cuid())
  name            String
  email           String           @unique
  role            UserRole         @default(REQUESTER) 
  
  // ... (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
  
  // (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö NextAuth ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
  // Account   Account[]
  // Session   Session[]

  @@map("users")
}
// (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ö‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠ (‡πÉ‡∏ö‡∏´‡∏•‡∏±‡∏Å)
enum RequestType {
  NORMAL
  URGENT
  PROJECT
}
model PurchaseRequest {
  id        String   @id // üëà ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏Å‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
  status    RequestStatus @default(Pending)
  totalAmount Decimal?   @map("total_amount")

  // 2. üîªüîª ‡πÄ‡∏û‡∏¥‡πà‡∏° 2 field ‡∏ô‡∏µ‡πâ üîªüîª
  requesterName String
  type          RequestType

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  user    User     @relation(fields: [userId], references: [id])
  userId  String   @map("user_id") // ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á

  items         RequestItem[]
  approvalSteps ApprovalStep[]
  history       RequestHistory[]
  purchaseOrder PurchaseOrder?

  @@map("purchase_requests")
}

// (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÉ‡∏ö‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠
model RequestItem {
  id        String   @id @default(cuid())
  
  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Field ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á
  itemName  String
  detail    String?
  imageUrl  String?
  quantity  Int
  unitPrice Decimal  @db.Decimal(10, 2) // (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Decimal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤)

  // ‚ùå ‡∏•‡∏ö 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏ó‡∏¥‡πâ‡∏á ‚ùå
  // itemMaster   ItemMaster @relation(fields: [itemMasterId], references: [id])
  // itemMasterId String

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡πÉ‡∏ö PR ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
  request   PurchaseRequest @relation(fields: [requestId], references: [id])
  requestId String
}

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
model ApprovalStep {
  id         String         @id @default(cuid())
  stepName   String         @map("step_name")
  status     ApprovalStatus @default(Pending)
  comment    String?
  approvedAt DateTime?      @map("approved_at")

  request    PurchaseRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId  String          @map("request_id")

  approver   User            @relation(fields: [approverId], references: [id])
  approverId String          @map("approver_id")

  @@map("approval_steps")
}

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
model RequestHistory {
  id        String   @id @default(cuid())
  action    String
  details   String?
  timestamp DateTime @default(now())

  request   PurchaseRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId String          @map("request_id")

  actor     User            @relation(fields: [actorId], references: [id])
  actorId   String          @map("actor_id")

  @@map("request_history")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (PO)
model PurchaseOrder {
  id       String   @id @default(cuid())
  poNumber String   @unique @map("po_number") // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà PO
  status   POStatus @default(Pending)
  sentAt   DateTime? @map("sent_at")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  request   PurchaseRequest @relation(fields: [requestId], references: [id])
  requestId String          @unique @map("request_id") // 1 PO ‡∏°‡∏≤‡∏à‡∏≤‡∏Å 1 Request

  items     PurchaseOrderItem[]
  receipts  GoodsReceipt[] // 1 PO ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏¢‡∏≠‡∏¢‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (‡∏´‡∏•‡∏≤‡∏¢ Delivery)

  @@map("purchase_orders")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô PO
model PurchaseOrderItem {
  id        String  @id @default(cuid())
  quantity  Int
  unitPrice Decimal @map("unit_price") // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡∏•‡∏á‡∏à‡∏£‡∏¥‡∏á

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  po     PurchaseOrder @relation(fields: [poId], references: [id], onDelete: Cascade)
  poId   String        @map("po_id")

  itemMaster ItemMaster    @relation(fields: [itemMasterId], references: [id])
  itemMasterId String      @map("item_master_id") // üëà Foreign Key ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Catalog
  
  receiptItems GoodsReceiptItem[] // 1 PO Item ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ó‡∏¢‡∏≠‡∏¢‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á

  @@map("purchase_order_items")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (Goods Receipt / Delivery Note)
model GoodsReceipt {
  id        String    @id @default(cuid())
  notes     String?   // ‡πÄ‡∏ä‡πà‡∏ô "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ö‡∏∏‡∏ö", "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á XXX"
  receivedAt DateTime @default(now()) @map("received_at")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  po        PurchaseOrder @relation(fields: [poId], references: [id])
  poId      String        @map("po_id") // üëà ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏à‡∏≤‡∏Å PO ‡πÉ‡∏ö‡πÑ‡∏´‡∏ô

  receivedBy User         @relation(fields: [receivedById], references: [id])
  receivedById String     @map("received_by_id") // üëà ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á

  items     GoodsReceiptItem[] // üëà ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ

  @@map("goods_receipts")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö (Items ‡πÉ‡∏ô Delivery)
model GoodsReceiptItem {
  id               String @id @default(cuid())
  quantityReceived Int    @map("quantity_received")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  receipt          GoodsReceipt      @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  receiptId        String            @map("receipt_id")

  poItem           PurchaseOrderItem @relation(fields: [poItemId], references: [id])
  poItemId         String            @map("po_item_id") // üëà ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏ô‡∏à‡∏≤‡∏Å PO

  @@map("goods_receipt_items")
}