// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// üõë (‡∏•‡∏ö) enum RequestStatus (PascalCase) ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 10-17 ‡πÄ‡∏î‡∏¥‡∏°)
// üõë (‡∏•‡∏ö) enum ApprovalStatus (PascalCase) ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 19-23 ‡πÄ‡∏î‡∏¥‡∏°)

enum POStatus {
  Pending   @map("pending")  // ‡∏£‡πà‡∏≤‡∏á PO
  Sent      @map("sent")      // ‡∏™‡πà‡∏á PO ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Vendor ‡∏Å‡πá‡∏ï‡∏≤‡∏°)
  Partial   @map("partial")  // ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  Fulfilled @map("fulfilled") // ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  Cancelled @map("cancelled")
}

//--- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ (Process Tables) ---

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
enum UserRole {
  Requester @map("requester") 
  Approver  @map("approver")  
  Purchaser @map("purchaser")  
  Admin     @map("admin") 
  User      @map("user")
}

model User {
  id               String           @id @default(cuid())
  name             String
  email            String           @unique
  role             UserRole         @default(Requester)
  
  purchaseRequests PurchaseRequest[] 
  approvalSteps    ApprovalStep[]    
  historyEntries   RequestHistory[]  
  goodsReceipts    GoodsReceipt[]   
  @@map("users")
}

// (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ö‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠ (‡πÉ‡∏ö‡∏´‡∏•‡∏±‡∏Å)
enum RequestType {
  NORMAL
  URGENT
  PROJECT
}

// 
// ‚úÖ (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) enum RequestStatus (lowercase) ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 66 ‡πÄ‡∏î‡∏¥‡∏°)
// 
enum RequestStatus {
  pending
  approved
  rejected
  ordered
  received
  cancelled
}


model PurchaseRequest {
  id        String   @id 
  status    RequestStatus @default(pending) // üëà ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Enum (lowercase) ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
  totalAmount Decimal? @map("total_amount")

  requesterName String
  type          RequestTypecd
  dueDate   DateTime?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  user    User     @relation(fields: [userId], references: [id])
  userId  String   @map("user_id") // ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á

  items         RequestItem[]
  approvalSteps ApprovalStep[]
  history       RequestHistory[]
  @@map("purchase_requests")
}

//‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÉ‡∏ö‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠
model RequestItem {
  id        String   @id @default(cuid())
 
  itemName  String
  detail    String?
  imageUrl  String?
  quantity  Int
  unitPrice Decimal  @db.Decimal(10, 2) 

  request   PurchaseRequest @relation(fields: [requestId], references: [id])
  requestId String
  quantityOrdered Int @default(0) @map("quantity_ordered")
  poItems PurchaseOrderItem[]
}

// 
// ‚úÖ (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) enum ApprovalStatus (lowercase) ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 113 ‡πÄ‡∏î‡∏¥‡∏°)
// 
enum ApprovalStatus {
  pending   // üëà lowercase
  approved  // üëà lowercase
  rejected  // üëà lowercase
}

model ApprovalStep {
  id         String         @id @default(cuid())
  stepName   String         @map("step_name")
  status     ApprovalStatus @default(pending) // üëà ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Enum (lowercase) ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
  comment    String?
  approvedAt DateTime?      @map("approved_at")

  request    PurchaseRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId  String          @map("request_id")

  approver   User            @relation(fields: [approverId], references: [id])
  approverId String          @map("approver_id")

  @@unique([requestId, stepName, approverId]) 
  @@map("approval_steps")
}

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
model RequestHistory {
  id        String   @id @default(cuid())
  action    String
  details   String?
  timestamp DateTime @default(now())

  request   PurchaseRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId String          @map("request_id")

  actor     User            @relation(fields: [actorId], references: [id])
  actorId   String          @map("actor_id")

  @@map("request_history")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (PO)
model PurchaseOrder {
  id       String   @id @default(cuid())
  poNumber String   @unique @map("po_number") // ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà PO
  status   POStatus @default(Pending)
 
  sentAt   DateTime? @map("sent_at")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items     PurchaseOrderItem[]
  receipts  GoodsReceipt[] // 1 PO ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏¢‡∏≠‡∏¢‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (‡∏´‡∏•‡∏≤‡∏¢ Delivery)

  @@map("purchase_orders")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô PO
model PurchaseOrderItem {
  id        String  @id @default(cuid())
  quantity  Int
  unitPrice Decimal @map("unit_price") // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡∏•‡∏á‡∏à‡∏£‡∏¥‡∏á
  quotationNumber String?

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  po     PurchaseOrder @relation(fields: [poId], references: [id], onDelete: Cascade)
  poId   String        @map("po_id")

  itemName String // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
  detail   String?
  imageUrl String?
  requestItem   RequestItem? @relation(fields: [requestItemId], references: [id], onDelete: SetNull)
  requestItemId String?      @map("request_item_id")

  receiptItems GoodsReceiptItem[]
  @@map("purchase_order_items")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (Goods Receipt / Delivery Note)
model GoodsReceipt {
  id        String    @id @default(cuid())
  notes     String?
  receivedAt DateTime @default(now()) @map("received_at")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  po        PurchaseOrder @relation(fields: [poId], references: [id])
  poId      String        @map("po_id") 

  receivedBy User         @relation(fields: [receivedById], references: [id])
  receivedById String     @map("received_by_id") 

  items     GoodsReceiptItem[] 

  @@map("goods_receipts")
}

// (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö (Items ‡πÉ‡∏ô Delivery)
model GoodsReceiptItem {
  id                 String @id @default(cuid())
  quantityReceived Int    @map("quantity_received")

  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
  receipt          GoodsReceipt      @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  receiptId        String            @map("receipt_id")

  poItem           PurchaseOrderItem @relation(fields: [poItemId], references: [id])
  poItemId         String            @map("po_item_id") 

  @@map("goods_receipt_items")
}